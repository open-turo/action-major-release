name: GitHub Action Major Release
description: GitHub Action that conditionally creates a floating branch for a major release
inputs:
  major-version:
    required: true
    description: The major version to publish. This will update the branch `v<major-version>` to the current git sha.
  dry-run:
    required: false
    description: Whether to run the action in dry-run mode - no branches will be created or pushed.
    default: "false"
runs:
  using: composite
  steps:
    - name: Create and push branch
      if: inputs.dry-run != 'true'
      shell: bash
      env:
        MAJOR_VERSION: ${{ inputs.major-version }}
      run: |
        echo "Updating branch: v$MAJOR_VERSION"
        git tag -f v$MAJOR_VERSION
        git branch -f v$MAJOR_VERSION
        git push -f origin refs/tags/v$MAJOR_VERSION
        git push -f origin refs/heads/v$MAJOR_VERSION
    - name: "Dry-run: Create and push branch"
      if: inputs.dry-run == 'true'
      shell: bash
      env:
        MAJOR_VERSION: ${{ inputs.major-version }}
      run: |
        echo "Updating branch: v$MAJOR_VERSION"
        echo "  (dry-run)"
        echo "git tag -f v$MAJOR_VERSION"
        echo "git branch -f v$MAJOR_VERSION"
        echo "git push -f origin refs/tags/v$MAJOR_VERSION"
        echo "git push -f origin refs/heads/v$MAJOR_VERSION"
